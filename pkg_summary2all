#!/bin/sh

set -e

#
usage (){
    echo 'usage: pkg_summary2all <bin|src> <files...>'
}

if test $# -gt 2 || test _$1 '!=' _bin -a _$1 '!=' _src
then
    usage
    exit 1
fi

#
binsrc=$1
shift;

if test _$binsrc = _bin
then
    fields='pkgpath depends conflicts comment build_date categories homepage license os_version pkgtools_version provides requires description'
else
    fields='pkgpath depends build_depends conflicts index homepage comment license onlyfor notfor maintainer categories plist description'
fi

export PKG_SUMMARY_TYPE=$binsrc

for i in $fields
do
    printf "index for field %s" $i...
    ./pkg_summary2field-index $i "$@"
    printf "done\n"
done

printf "%s" 'information about packages...'
./pkg_summary2dict "$@"
printf "done\n"
